# =============================================================================
# ENHANCED TMUX CONFIGURATION FOR DARK-TERMINAL
# =============================================================================

# --- General Settings ---
# Set default shell
set -g default-command "${SHELL}"

# Set prefix to Ctrl+a
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Enable mouse support
set -g mouse on

# Set a shorter escape time for faster command execution
set -s escape-time 10

# Increase history limit
set -g history-limit 50000

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Enable focus events
set -g focus-events on

# Set terminal colors
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*256col*:Tc"

# --- Enhanced Keybindings ---
# Reload config file
bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded!"

# Split panes using | and -
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Switch panes using Alt-arrow without prefix
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

# Resize panes
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Window management
bind c new-window -c "#{pane_current_path}"
bind w list-windows
bind n next-window
bind p previous-window
bind 0 select-window -t :0
bind 1 select-window -t :1
bind 2 select-window -t :2
bind 3 select-window -t :3
bind 4 select-window -t :4
bind 5 select-window -t :5
bind 6 select-window -t :6
bind 7 select-window -t :7
bind 8 select-window -t :8
bind 9 select-window -t :9

# Pane management
bind x kill-pane
bind X kill-window
bind z toggle-pane-zoom

# Session management
bind S new-session -c "#{pane_current_path}"
bind s choose-tree -Zs
bind C-s choose-tree -Zs

# Copy mode
bind Escape copy-mode
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection
bind -T copy-mode-vi r send-keys -X rectangle-toggle

# --- Enhanced Theme (Nord) ---
# Status bar
set -g status-position bottom
set -g status-justify left
set -g status-style 'bg=#3B4252 fg=#ECEFF4'

# Status left
set -g status-left '#[fg=#88C0D0,bg=#2E3440] #S #[fg=#ECEFF4,bg=#3B4252] | '
set -g status-left-length 50

# Status right
set -g status-right '#[fg=#8FBCBB,bg=#3B4252] %Y-%m-%d %H:%M #[fg=#88C0D0,bg=#2E3440] #(whoami)@#h '

# Window status
setw -g window-status-current-style 'fg=#2E3440 bg=#88C0D0'
setw -g window-status-current-format ' #I:#W#F '

setw -g window-status-style 'fg=#ECEFF4 bg=#3B4252'
setw -g window-status-format ' #I:#W#F '

setw -g window-status-separator ' '

# Pane borders
set -g pane-border-style 'fg=#3B4252'
set -g pane-active-border-style 'fg=#88C0D0'

# Message text
set -g message-style 'bg=#2E3440 fg=#ECEFF4'

# --- Enhanced Plugins ---
# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'tmux-plugins/tmux-sessionist'
set -g @plugin 'tmux-plugins/tmux-urlview'
set -g @plugin 'tmux-plugins/tmux-fpp'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-logging'

# --- Plugin Settings ---
# Continuum: auto-restore sessions on tmux start
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# Resurrect: save and restore tmux sessions
set -g @resurrect-save 'S'
set -g @resurrect-restore 'R'
set -g @resurrect-dir '~/.tmux/resurrect'

# Yank: copy to system clipboard
set -g @yank_selection 'primary'
set -g @yank_selection_mouse 'clipboard'

# Battery: show battery status
set -g @batt_icon_charge_tier8 ' '
set -g @batt_icon_charge_tier7 ' '
set -g @batt_icon_charge_tier6 ' '
set -g @batt_icon_charge_tier5 ' '
set -g @batt_icon_charge_tier4 ' '
set -g @batt_icon_charge_tier3 ' '
set -g @batt_icon_charge_tier2 ' '
set -g @batt_icon_charge_tier1 ' '

# CPU: show CPU usage
set -g @cpu_low_icon ' '
set -g @cpu_medium_icon ' '
set -g @cpu_high_icon ' '

# Copycat: search in tmux
set -g @copycat_search 'C-f'
set -g @copycat_git_search 'C-g'

# Logging: save tmux logs
set -g @logging-path '~/.tmux/logs'
set -g @logging-filename 'tmux-#{session_name}-#{window_index}-#{pane_index}-%Y%m%dT%H%M%S.log'

# --- Custom Keybindings ---
# Development workflow
bind D new-window -n dev -c "#{pane_current_path}"
bind C-D new-window -n dev -c "#{pane_current_path}"

# Quick file operations
bind f run-shell "tmux capture-pane -p -S - | grep -o 'http[s]\?://[^[:space:]]*' | head -1 | xargs -r open"
bind F run-shell "tmux capture-pane -p -S - | grep -o 'http[s]\?://[^[:space:]]*' | head -1 | xargs -r xdg-open"

# Quick directory navigation
bind g new-window -n git -c "#{pane_current_path}" "git status"
bind G new-window -n git -c "#{pane_current_path}" "git log --oneline --graph --decorate"

# Quick development tools
bind N new-window -n nvim -c "#{pane_current_path}" "nvim ."
bind L new-window -n lf -c "#{pane_current_path}" "lf"
bind T new-window -n test -c "#{pane_current_path}" "npm test"

# Quick system tools
bind H new-window -n htop -c "#{pane_current_path}" "htop"
bind I new-window -n info -c "#{pane_current_path}" "neofetch"
bind S new-window -n system -c "#{pane_current_path}" "systemctl status"

# --- Enhanced Window Management ---
# Automatically set window title
set-window-option -g automatic-rename on
set-option -g set-titles on
set-option -g set-titles-string '#T'

# Window activity monitoring
setw -g monitor-activity on
set -g visual-activity off

# --- Pane Synchronization ---
# Synchronize panes
bind y set-window-option synchronize-panes

# --- Enhanced Copy Mode ---
# Copy mode keybindings
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi r send-keys -X rectangle-toggle
bind -T copy-mode-vi Escape send-keys -X cancel

# --- Session Management ---
# Session switching
bind C-s choose-tree -Zs
bind s choose-tree -Zs

# Session creation
bind C new-session -c "#{pane_current_path}"
bind S new-session -c "#{pane_current_path}"

# --- Enhanced Status Bar ---
# Update status bar every 15 seconds
set -g status-interval 15

# Show session name in status bar
set -g status-left '#[fg=#88C0D0,bg=#2E3440] #S #[fg=#ECEFF4,bg=#3B4252] | '

# Show time and user in status bar
set -g status-right '#[fg=#8FBCBB,bg=#3B4252] %Y-%m-%d %H:%M #[fg=#88C0D0,bg=#2E3440] #(whoami)@#h '

# --- Performance Settings ---
# Reduce escape time
set -s escape-time 0

# Enable focus events
set -g focus-events on

# --- Initialize TPM ---
# Keep this line at the very bottom of tmux.conf
run '~/.tmux/plugins/tpm/tpm'
